<!DOCTYPE html>
<html lang="en">

<head></head>

<head>
  <meta charset="UTF-8">
  <title>Zeta Icon Validator</title>
  <style>
    body {
      margin: 16px;
    }

    li {
      margin-top: 8px;
    }

    .header {
      color: var(--main-primary);
    }

    .icon-heading {
      cursor: pointer;
      color: var(--border-primary);
    }
  </style>
</head>

<body>
  <h2 class="header">Zeta Icon Validator</h2>
  <div id="content"></div>
  <script>
    const content = document.getElementById("content");

    onmessage = ({ data }) => {
      if (data.pluginMessage === "clear") {
        content.innerHTML = "";
        return;
      }

      const iconErrors = data.pluginMessage;
      content.innerHTML = "";
      let hasErrors = false;

      for (const { name, id, errors } of iconErrors) {
        if (errors?.length) {
          if (!hasErrors) {
            content.appendChild(createHeading("Please fix the errors below and run the plugin again"));
            hasErrors = true;
          }
          content.appendChild(createIconHeading(name, id));
          const ul = document.createElement("ul");
          errors.forEach(error => ul.appendChild(createErrorElement(error)));
          content.appendChild(ul);
        }
      }

      if (!hasErrors) {
        content.appendChild(createBody("No errors found"));
        content.appendChild(createAnimation());
        loadAnimation();
      }
    };

    function createErrorElement(error) {
      const li = document.createElement("li");
      li.textContent = error.message;
      return li;
    }

    function createIconHeading(name, iconId) {
      const h3 = document.createElement("h3");
      h3.className = "icon-heading";
      h3.textContent = name;
      h3.onclick = () => parent.postMessage({ pluginMessage: { type: "select-icon", iconId } }, "*");
      return h3;
    }

    function createHeading(msg) {
      const h3 = document.createElement("h3");
      h3.textContent = msg;
      return h3;
    }

    function createBody(msg) {
      const p = document.createElement("p");
      p.textContent = msg;
      return p;
    }

    function createAnimation() {
      const animation = document.createElement("lottie-player");
      animation.setAttribute("autoplay", "");
      animation.setAttribute("loop", "");
      animation.setAttribute("mode", "normal");
      animation.setAttribute('style', 'width: calc(100% - 48px); height: 150px; margin: 24px');

      return animation;
    }
  </script>
</body>

</html>